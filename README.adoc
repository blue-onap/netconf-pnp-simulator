= NETCONF Plug-and-Play Simulator

:sectnums:

:py-requirements: https://pip.pypa.io/en/stable/reference/pip_install/#requirements-file-format
:yang-rfc: https://tools.ietf.org/html/rfc6020

image:https://img.shields.io/github/v/tag/blue-onap/netconf-pnp-simulator?label=Release[GitHub tag]
image:https://img.shields.io/docker/cloud/automated/blueonap/netconf-pnp-simulator[link="https://hub.docker.com/r/blueonap/netconf-pnp-simulator/"]

== Overview

This project builds a modular engine that allows the creation of NETCONF-enabled devices simulators,
either physical (PNF), virtual (VNF), or cloud-native (CNF)

Simply put, it's a docker container running Sysrepo and Netopeer2 servers enhanced with a plugger script that
performs the following actions at start-time:

1. Configures TLS and SSH secure accesses to the Netopeer2 server;
2. Installs multiple YANG models into sysrepo datastore;
3. Launches the corresponding subscriber applications.

The picture below unveils the architecture of this solution.

image::images/Architecture.png[]

A YANG module contains the following files:

[options="header",cols="1,5a"]
|===
| Filename | Purpose

|`_model_.yang` | The YANG model specified according to {yang-rfc}[RFC-6020] and named after the module's name,
e.g., _mynetconf.yang_.
|`startup.json` or `startup.xml` | An optional data file with the initial values of the model.
Both JSON and XML formats are supported.
|`subscriber.py` | The Python 3 application that implements the behavioral aspects of the YANG model.
|`requirements.txt` | [Optional] Lists the additional Python packages required by the application,
specified in the {py-requirements}[Requirements File Format]. Example:

.requirements.txt
----
jmespath ~= 0.9
lxml ~= 4.4
requests ~= 2.23
----
|===

== Application

The `subscriber` application can implement any wanted passive or active behaviour:

Passive Behaviour:: The subscriber will receive an event for each modification externally applied to the YANG model.

Active Behaviour:: At any point in time the subscriber can proactively change its own YANG model.

== Runtime Configuration

=== Customizing TLS and SSH accesses

The distributed docker image comes with a sample configuration for TLS and SSH, that can be found at
`/config/tls` and `/config/ssh` directories respectively. The user can replace one or both configurations
by mounting a custom directory under the respective TLS or SSH mounting point.

==== TLS Configuration

You need to provide the following PEM files under `/config/tls`:

[options="header",cols="1m,5"]
.TLS Configuration Files
|===
| File | Contents
| `server_key.pem` | The server's private key in plain (_not_ protected by a passphrase).
| `server_cert.pem` | The corresponding server's X.509v3 certificate.
| `ca.pem` | The Certificate Authority (CA) certificate.
|===

TIP: You can reload the configuration at runtime
by running `docker exec <__CONTAINER NAME or ID__> /opt/bin/configure-tls.sh`

==== SSH Configuration

For the SSH connection, you need to provide the public SSH key in one of these 3 files under `/config/ssh`
in order of preference:

- `id_ecdsa.pub`; or
- `id_dsa.pub`; or
- `id_rsa.pub`

TIP: You can reload the configuration at runtime
by running `docker exec <__CONTAINER NAME or ID__> /opt/bin/configure-ssh.sh`

=== Python Virtual Environment Support

Python programs usually use additional packages not included in the standard Python distribution,
like the `requests` package, for example.
We support this scenario by creating isolated Python environments for each custom-provided module whenever
a `requirements.txt` file is present in the module directory.

== Example Module

The directory `examples/mynetconf` contains an example YANG model and its subscriber along with a
Docker Compose configuration file to launch a basic simulator.
